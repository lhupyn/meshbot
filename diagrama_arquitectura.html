<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura Avanzada de MeshBot</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mermaid.js para el diagrama -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <!-- Google Fonts: Inter y Roboto Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .description-item:hover {
            background-color: #f9fafb; /* bg-gray-50 */
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        .footer {
            font-family: 'Roboto Mono', monospace;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-4">
    <div class="container max-w-6xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
            <!-- Encabezado -->
            <div class="p-6 sm:p-8 border-b border-gray-200">
                <h1 class="text-2xl sm:text-4xl font-extrabold text-gray-900 tracking-tight">Arquitectura de MeshBot</h1>
                <p class="text-gray-500 mt-2">Visualizaci√≥n del flujo de datos desde la red LoRa hasta la IA y viceversa.</p>
            </div>
            
            <!-- Contenedor del Diagrama -->
            <div class="bg-gray-50/50 p-6 sm:p-8 flex justify-center items-center">
                <div class="mermaid w-full">
                    graph TD
                        subgraph "Red Meshtastic (LoRa)"
                            G1["üì°<br><b>Gateway</b>"]
                            U["üìª<br><b>Radio Usuario</b><br>(Interact√∫a con Bot)"]
                            T1["üõ∞Ô∏è<br><b>Radios con Datos de mensajeria</b>"]
                        end

                        subgraph "Red Local (Internet/LAN)"
                            B["üåê<br><b>Broker MQTT</b>"]
                            C["ü§ñ<br><b>MeshBot</b><br>(Nodo Virtual)"]
                        end

                        subgraph "Procesamiento IA"
                            D["üß†<br><b>Motor de IA</b><br>(API IA GPU)"]
                        end

                        U -- "Mensaje para el Bot" --> G1
                        T1 -- "Datos y Mensajes" --> G1
                        G1 -- "Reenv√≠a a Red Local" --> B
                        B -- "Publica en Topics" --> C
                        C -- "Consulta a la API" --> D
                        D -- "Respuesta generada" --> C
                        C -- "Mensaje de respuesta" --> B
                        B -- "Paquete para el nodo (Salida)" --> G1
                        G1 -- "Transmisi√≥n LoRa" --> U

                        style G1 fill:#ec4899,stroke:#db2777,stroke-width:2px,color:#fff
                        style U fill:#374151,stroke:#1f2937,stroke-width:2px,color:#fff
                        style T1 fill:#34d399,stroke:#059669,stroke-width:2px,color:#064e3b
                        style B fill:#3b82f6,stroke:#2563eb,stroke-width:2px,color:#fff
                        style C fill:#22c55e,stroke:#16a34a,stroke-width:2px,color:#fff
                        style D fill:#f59e0b,stroke:#d97706,stroke-width:2px,color:#fff
                </div>
            </div>

            <!-- Contenedor de la Descripci√≥n -->
            <div class="p-6 sm:p-8 border-t border-gray-200">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">Descripci√≥n del Flujo</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Flujo de Entrada -->
                    <div class="space-y-3">
                        <h3 class="text-lg font-semibold text-blue-600 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                            Flujo de Entrada (Red ‚Üí Bot)
                        </h3>
                        <ol class="space-y-3 text-gray-600">
                            <li class="description-item p-3 rounded-lg"><b>1. Radios en la Red:</b> M√∫ltiples nodos env√≠an datos por LoRa, incluyendo mensajes de texto y datos de telemetr√≠a.</li>
                            <li class="description-item p-3 rounded-lg"><b>2. Gateway:</b> Un gateway conectado a internet recibe estos paquetes y los reenv√≠a a la red local.</li>
                            <li class="description-item p-3 rounded-lg"><b>3. Broker MQTT:</b> Centraliza los datos del gateway y los publica en topics.</li>
                            <li class="description-item p-3 rounded-lg"><b>4. MeshBot (Nodo Virtual):</b> Escucha los topics, almacena la telemetr√≠a y procesa los mensajes dirigidos al bot.</li>
                            <li class="description-item p-3 rounded-lg"><b>5. IA (GPU):</b> Si un mensaje es una consulta, el bot se conecta a la API para generar una respuesta.</li>
                        </ol>
                    </div>
                    <!-- Flujo de Salida -->
                    <div class="space-y-3">
                        <h3 class="text-lg font-semibold text-green-600 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path></svg>
                            Flujo de Salida (Bot ‚Üí Usuario)
                        </h3>
                        <ol class="space-y-3 text-gray-600">
                            <li class="description-item p-3 rounded-lg"><b>6. MeshBot (Nodo Virtual):</b> Con la respuesta de la IA, crea un nuevo paquete de Meshtastic.</li>
                            <li class="description-item p-3 rounded-lg"><b>7. Broker MQTT:</b> Publica este paquete de respuesta en el "topic" de MQTT.</li>
                            <li class="description-item p-3 rounded-lg"><b>8. Gateway:</b> Recibe el paquete y lo prepara para la transmisi√≥n por radio.</li>
                            <li class="description-item p-3 rounded-lg"><b>9. Radio Usuario:</b> El gateway transmite la respuesta por LoRa, que llega al dispositivo del usuario.</li>
                        </ol>
                    </div>
                </div>
            </div>
            <!-- Footer -->
             <footer class="footer text-center py-4 text-xs text-gray-500 border-t border-gray-200">
                <p>&copy; 2025 MeshBot Project | Diagrama generado con Mermaid.js</p>
            </footer>
        </div>
    </div>
    <script>
        // Inicializa Mermaid con el tema por defecto y lo renderiza
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'default',
            fontFamily: 'Inter, sans-serif'
        });
    </script>
</body>
</html>
